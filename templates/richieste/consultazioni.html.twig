{% extends 'ruolo_staff/index.html.twig' %}

{% block pagina_contenuto %}
<div class="container-fluid">
  <h1 class="text-center gs-h2 gs-mt-2">{{ 'title.richieste.consultazioni'|trans }}</h1>
  {% if dati|length == 0 %}
  <div class="alert alert-info text-center gs-big">
    <strong>Non sono presenti dati</strong>
  </div>
  {% else %}
  <table class="table table-bordered table-hover table-striped gs-mb-0">
    <thead class="bg-success">
      <tr>
        <th>{{ 'label.nome'|trans }}</th>
        <th>{{ 'label.stato'|trans }}</th>
        <th>{{ 'label.consultazione_risposte'|trans }}</th>
        <th>{{ 'label.action'|trans }}</th>
      </tr>
    </thead>
    <tbody>
    {% for kc,c in dati %}
      <tr>
        <td><strong>{{ c.nome }}</strong></td>
        <td>
      {% if c.stato == 'O' %}
          <div class="alert-warning text-center gs-pt-1 gs-pb-1" style="width:auto"><strong>{{ 'label.consultazione_in_corso'|trans|upper }}</strong></div>
      {% elseif c.stato == 'W' %}
          <div class="alert-info text-center gs-pt-1 gs-pb-1"><strong>{{ 'label.consultazione_in_attesa'|trans|upper }}</strong></div>
      {% else %}
          <div class="text-center"><strong>{{ 'label.consultazione_chiusa'|trans|upper }}</strong></div>
      {% endif %}
        </td>
        <td>{{ c.risposte }}</td>
        <td>
          <button type="button" class="btn btn-primary btn-xs mr-2 mb-1" title="Visualizza i dettagli della consultazione" data-toggle="modal" data-target="#gs-modal-info" data-title="Consultazione: {{ c.nome }}" data-body="consultazione-{{ loop.index }}"><strong>{{ 'label.show'|trans }}</strong></button>
      {% if c.stato == 'C' %}
          <button type="button" class="btn btn-primary btn-xs mr-2 mb-1" title="Visualizza l'esito della consultazione" data-toggle="modal" data-target="#gs-modal-remote" data-href="{{ path('richieste_esito', {consultazione: c.id}) }}"><strong>Mostra esito</strong></button>
          <a type="button" class="btn btn-primary btn-xs mr-2 mb-1" title="Scarica il documento con l'esito della consultazione" href="{{ path('richieste_esito', {consultazione: c.id, formato:'P'}) }}"><strong>Scarica esito</strong></button>
      {% endif %}
          <div id="consultazione-{{ loop.index }}" style="display:none">
            <div class="row">
              <div class="col-sm-4">
      {% if c.stato == 'O' %}
                <div class="alert alert-warning text-center gs-pt-1 gs-pb-1" style="width:auto"><strong>{{ 'label.consultazione_in_corso'|trans|upper }}</strong></div>
      {% elseif c.stato == 'W' %}
                <div class="alert alert-info text-center gs-pt-1 gs-pb-1"><strong>{{ 'label.consultazione_in_attesa'|trans|upper }}</strong></div>
      {% else %}
                <div class="text-center gs-mb-4"><strong>{{ 'label.consultazione_chiusa'|trans|upper }}</strong></div>
      {% endif %}
              </div>
              <div class="col-sm-4"><strong>Inizio: </strong>{{ inizio|date('d/m/Y H:i') }}</div>
              <div class="col-sm-4"><strong>Fine: </strong>{{ inizio|date('d/m/Y H:i') }}</div>
            </div>
            <div class="row gs-mb-2 gs-pb-3 gs-pl-4">
              <div class="col-sm-12"><strong>Destinatari: </strong>{% for d in c.destinatari %}{{ d|trans }}{{ not loop.last ? ', ' }}{% endfor %}</div>
            </div>
            <div class="row gs-mb-2 gs-pb-3 gs-pl-4">
              <div class="col-sm-12"><strong>Sede: </strong>{{ c.sede ? c.sede : 'label.tutte_sedi'|trans }}</div>
            </div>
            <div class="row gs-mb-2 gs-pb-3 gs-pl-4">
              <div class="col-sm-12"><strong>Classi: </strong>
                {% if c.classi is not empty %}{% for c in c.classi %}{{ c }}{{ not loop.last ? ', ' }}{% endfor %}{% else %}{{ 'label.tutte_classi'|trans }}{% endif %}
              </div>
            </div>
          </div>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% include 'include/modal-info.html.twig' %}
  {% include 'include/modal-remote.html.twig' %}
  {% endif %}
</div>
{% endblock %}

{% block pagina_js_fine %}
{{ parent() }}
<script>
$(document).ready(function() {
  $('#gs-modal-remote').on('show.bs.modal', function (event) {
    var url = $(event.relatedTarget).data('href');
    $(this).find('#gs-modal-remote-content').load(url);
  });
  $(".gs-button-remote").click(function(e) {
    e.preventDefault();
    $('#gs-modal-remote-content').html('<div class="modal-content"><div class="modal-header"><h3 class="modal-title">Attendere prego...</h3></div><div class="modal-body"><div class="progress"><div class="progress-bar progress-bar-info progress-bar-striped active" style="width: 100%"></div></div></div></div>');
  });
  $('#gs-modal-info').on('show.bs.modal', function (e) {
    var title = $(e.relatedTarget).data('title');
    var id = $(e.relatedTarget).data('body');
    var html = $('#'+id).html();
    $(this).find('#gs-modal-info-label').html(title);
    $(this).find('#gs-modal-info-body').html(html);
  });
});
</script>
{% endblock %}
